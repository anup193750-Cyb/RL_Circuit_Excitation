<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RC Circuit Simulator — AC Excitation (Vm·cos ωt)</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1720; --muted:#9aa6b2; --accent:#60a5fa; --accent2:#f6c84c;
      --card:#0f1720; --text:#e6eef6;
    }
    body{background:var(--bg); color:var(--text); font-family:Inter, "Segoe UI", Roboto, sans-serif; margin:0;}
    header{padding:18px 12px; text-align:center; background:linear-gradient(90deg,#071023, #0c1a2b); border-bottom:1px solid #081017;}
    header h1{margin:0; font-size:1.2rem; color:var(--accent);}
    .top{max-width:1200px;margin:16px auto;padding:12px;}
    .controls{display:flex;flex-wrap:wrap;gap:12px; background:var(--panel); padding:14px;border-radius:10px;align-items:center;justify-content:center;}
    .control{min-width:180px;color:var(--muted); text-align:center;}
    .control label{display:block;font-size:0.9rem;margin-bottom:8px;color:var(--text);}
    input[type=range]{width:100%;}
    .toggles{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:8px;}
    .plots{display:grid;grid-template-columns:1fr 1fr; gap:14px; max-width:1200px;margin:18px auto;padding:0 12px;}
    .card{background:var(--card); border-radius:10px;padding:10px; box-shadow:0 6px 18px rgba(2,6,23,0.5);}
    .plotbox{height:360px;}
    .bottom{max-width:1200px;margin:14px auto;padding:12px;color:var(--muted);}
    .row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;}
    button.small{background:transparent;border:1px solid #213144;color:var(--muted);padding:6px 10px;border-radius:6px;cursor:pointer;}
    .info{font-size:0.9rem;color:var(--muted);margin-top:8px;text-align:center;}
    @media(max-width:900px){ .plots{grid-template-columns:1fr;} .plotbox{height:320px;} }
  </style>
</head>
<body>
  <header>
    <h1>⚡ RC Circuit Simulator — V(t)=Vₘ·cos(ωt) (Transient + Steady-state + Phasor)</h1>
  </header>

  <div class="top">
    <div class="controls card">
      <div class="control">
        <label>Resistance R (Ω) <span id="Rdisp">10</span></label>
        <input id="R" type="range" min="0" max="200" step="1" value="10">
      </div>
      <div class="control">
        <label>Capacitance C (µF) <span id="Cdisp">0.10</span></label>
        <input id="C" type="range" min="0.001" max="1" step="0.001" value="0.1">
      </div>
      <div class="control">
        <label>Frequency f (Hz) <span id="fdisp">50</span></label>
        <input id="f" type="range" min="10" max="5000" step="10" value="50">
      </div>
      <div class="control">
        <label>Amplitude Vₘ (V) <span id="Vdisp">10</span></label>
        <input id="Vm" type="range" min="1" max="100" step="1" value="10">
      </div>

      <div style="width:100%;display:flex;gap:12px;justify-content:center;margin-top:8px;">
        <label style="color:var(--muted);font-size:0.9rem;">
          <input id="normalize" type="checkbox"> Normalize amplitudes
        </label>
        <label style="color:var(--muted);font-size:0.9rem;">
          <input id="showTransient" type="checkbox" checked> Show transient term
        </label>
      </div>
      <div class="info">Move mouse over plots to view instantaneous values (hover). First few cycles include transient build-up.</div>
    </div>
  </div>

  <div class="plots">
    <div class="card plotbox" id="timePlotDiv"></div>
    <div class="card plotbox" id="viPlotDiv"></div>

    <div class="card plotbox" id="transientDiv"></div>
    <div class="card plotbox" id="phasorDiv"></div>
  </div>

  <div class="bottom card">
    <div class="row" id="calcInfo"></div>
    <div class="info">Formulas: Z = √(R² + (1/ωC)²), φ = atan(1/(ωRC)). Steady-state i<sub>ss</sub>(t) = (Vₘ/Z) cos(ωt + φ). Transient term = −Iₘ cosφ · e^(−t/RC) (zero-current initial condition).</div>
  </div>

<script>
  // DOM
  const R = document.getElementById('R'), C = document.getElementById('C'), f = document.getElementById('f'), Vm = document.getElementById('Vm');
  const Rdisp = document.getElementById('Rdisp'), Cdisp = document.getElementById('Cdisp'), fdisp = document.getElementById('fdisp'), Vdisp = document.getElementById('Vdisp');
  const normalize = document.getElementById('normalize'), showTransient = document.getElementById('showTransient');

  // Helper: format microfarads display for slider (slider in mF units as µF input)
  function updateDisplays(){
    Rdisp.textContent = parseFloat(R.value).toFixed(0);
    // C slider uses units of milli-F (0.001 to 1) representing Farads; show µF
    Cdisp.textContent = (parseFloat(C.value)*1e6).toFixed(2) + 'µ';
    fdisp.textContent = parseFloat(f.value).toFixed(0);
    Vdisp.textContent = parseFloat(Vm.value).toFixed(1);
  }

  // Physics & compute
  function computeWaveforms(){
    const Rv = parseFloat(R.value);
    const Cv = parseFloat(C.value); // slider in Farads (0.001 = 1 mF = 1000 µF). We'll treat as Farads.
    const fv = parseFloat(f.value);
    const Vmv = parseFloat(Vm.value);

    // Angular frequency and impedance
    const omega = 2*Math.PI*fv;
    const Xc = 1/(omega * Cv || 1e-30); // capacitive reactance
    const Z = Math.sqrt(Rv*Rv + Xc*Xc);
    // Phase: current leads voltage by phi = atan(Xc/R) but since Xc positive large -> phi = atan(1/(omega R C))
    const phi = Math.atan2(Xc, Rv); // phi >0 means I leads V by phi
    const Im = Vmv / Z;
    const tau = Rv * Cv; // RC time constant (s)
    // Time vector: include enough cycles and fine steps
    const cycles = Math.max(6, Math.ceil( (fv<50?6:Math.min(20, 6 + Math.log10(fv)*2)) )); // adapt
    const T = 1/fv;
    const tEnd = Math.max(3*T, Math.min(0.2, cycles*T)); // show a few cycles, cap to 0.2s for speed
    const N = 1200;
    const dt = tEnd / N;
    const t = new Array(N);
    for(let i=0;i<N;i++) t[i]=i*dt;

    // Waveforms
    const v = t.map(tt => Vmv * Math.cos(omega*tt));
    const iss = t.map(tt => Im * Math.cos(omega*tt + phi));
    // Transient term for zero initial current: A = -Im*cos(phi)
    const A = -Im * Math.cos(phi);
    const transientTerm = t.map(tt => A * Math.exp(-tt / (tau || 1e-30)));
    const itotal = t.map((tt,idx) => iss[idx] + transientTerm[idx]);

    return {Rv, Cv, fv, Vmv, omega, Xc, Z, phi, Im, tau, t, v, iss, transientTerm, itotal};
  }

  // Plotting functions
  function plotAll(){
    updateDisplays();
    const data = computeWaveforms();
    const {t,v, iss, transientTerm, itotal, phi, Z, Im, tau, Rv, Cv, fv, Vmv} = data;

    const norm = normalize.checked;
    // if normalize: scale both v and i to [-1,1]
    const vPlot = norm ? v.map(x=>x/Math.max(...v.map(Math.abs))) : v;
    const scaleI = norm ? (1/Math.max(...itotal.map(Math.abs))) : 1;
    const iPlot = norm ? itotal.map(x=>x*scaleI) : itotal;

    // Time plot: show V(t), I_total, and optional steady-state and transient components
    const tracesTime = [
      { x: t, y: vPlot, name: 'V(t)', mode:'lines', line:{color:'#60a5fa',width:2}, hovertemplate: 't=%{x:.5f}s<br>V=%{y:.3f}<extra></extra>' },
      { x: t, y: iPlot, name: 'I(t) total', mode:'lines', line:{color:'#f6c84c',width:2}, hovertemplate: 't=%{x:.5f}s<br>I=%{y:.5f}<extra></extra>' }
    ];
    if(showTransient.checked){
      const ssPlot = norm ? iss.map(x=>x*scaleI) : iss;
      const trPlot = norm ? transientTerm.map(x=>x*scaleI) : transientTerm;
      tracesTime.push({ x:t, y:ssPlot, name:'I (steady)', mode:'lines', line:{color:'#fb7185',dash:'dash',width:1.5}, hovertemplate: 't=%{x:.5f}s<br>I_ss=%{y:.5f}<extra></extra>'});
      tracesTime.push({ x:t, y:trPlot, name:'I (transient)', mode:'lines', line:{color:'#94a3b8',dash:'dot',width:1.5}, hovertemplate: 't=%{x:.5f}s<br>I_tr=%{y:.5f}<extra></extra>'});
    }

    Plotly.react('timePlotDiv', tracesTime, {
      title:{text:'V(t) and I(t) vs Time', font:{color:'#e6eef6'}},
      paper_bgcolor:'#0f1720', plot_bgcolor:'#0f1720',
      xaxis:{title:'Time (s)',color:'#cbd5e1'}, yaxis:{title: norm ? 'Normalized' : 'Amplitude', color:'#cbd5e1'},
      legend:{font:{color:'#cbd5e1'}}, hovermode:'x unified'
    }, {responsive:true});

    // V-I Lissajous
    const vVI = v, iVI = itotal;
    Plotly.react('viPlotDiv', [{ x:vVI, y:iVI, mode:'lines', line:{color:'#8b5cf6', width:2}, hovertemplate:'V=%{x:.3f} V<br>I=%{y:.5f} A<extra></extra>' }], {
      title:{text:'V–I Characteristic (Lissajous)', font:{color:'#e6eef6'}},
      paper_bgcolor:'#0f1720', plot_bgcolor:'#0f1720',
      xaxis:{title:'Voltage (V)',color:'#cbd5e1'}, yaxis:{title:'Current (A)',color:'#cbd5e1'},
      legend:{font:{color:'#cbd5e1'}}, hovermode:'closest'
    }, {responsive:true});

    // Transient only plot (exponential)
    Plotly.react('transientDiv', [
      { x:t, y:transientTerm, mode:'lines', name:'Transient term', line:{color:'#94a3b8',width:2}, hovertemplate:'t=%{x:.5f}s<br>I_tr=%{y:.5f}<extra></extra>' },
      { x:t, y:iss, mode:'lines', name:'Steady-state (I_ss)', line:{color:'#fb7185',dash:'dash'}, hovertemplate:'t=%{x:.5f}s<br>I_ss=%{y:.5f}<extra></extra>' }
    ], {
      title:{text:'Transient Term & Steady-State (for comparison)', font:{color:'#e6eef6'}},
      paper_bgcolor:'#0f1720', plot_bgcolor:'#0f1720',
      xaxis:{title:'Time (s)',color:'#cbd5e1'}, yaxis:{title:'Current (A)',color:'#cbd5e1'},
      legend:{font:{color:'#cbd5e1'}}, hovermode:'x'
    }, {responsive:true});

    // Phasor diagram (plot arrows: V on x-axis, I at +phi)
    // We'll set V phasor horizontal with magnitude Vpeak (use RMS? keep peak for demo)
    const Vpeak = Vmv;
    const Ipeak = Im;
    // phasor endpoints
    const Vx = Vpeak, Vy = 0;
    const Ix = Ipeak*Math.cos(phi), Iy = Ipeak*Math.sin(phi); // I leads V -> positive phi
    const phasorTraces = [
      // origin to V
      { x:[0, Vx], y:[0, Vy], mode:'lines+markers', line:{color:'#60a5fa',width:3}, marker:{size:6}, name:'V phasor', hoverinfo:'none' },
      // origin to I
      { x:[0, Ix], y:[0, Iy], mode:'lines+markers', line:{color:'#f6c84c',width:3}, marker:{size:6}, name:'I phasor', hoverinfo:'none' },
      // dashed circle for magnitude guidance
      { x:[Vx*Math.cos(Math.PI*i/180) for (i of [])], y:[0], mode:'none', showlegend:false }
    ];
    // Simpler phasor plot without circle (Plotly doesn't need arrowheads; we can add annotations)
    const phLayout = {
      title:{text:'Phasor Diagram (V and I)', font:{color:'#e6eef6'}},
      paper_bgcolor:'#0f1720', plot_bgcolor:'#0f1720',
      xaxis:{title:'Real', color:'#cbd5e1', zeroline:true, zerolinecolor:'#334155'},
      yaxis:{title:'Imag', color:'#cbd5e1', zeroline:true, zerolinecolor:'#334155'},
      showlegend:false,
      shapes:[
        // V arrow (arrowhead via line + triangle)
        { type:'line', x0:0, y0:0, x1:Vx, y1:Vy, line:{color:'#60a5fa', width:3} },
        // I arrow
        { type:'line', x0:0, y0:0, x1:Ix, y1:Iy, line:{color:'#f6c84c', width:3} }
      ],
      annotations:[
        { x:Vx*1.02, y:Vy, ax:0, ay:0, text:`V (peak ${Vpeak.toFixed(2)} V)`, font:{color:'#60a5fa'}, showarrow:false },
        { x:Ix*1.02, y:Iy*1.02, ax:0, ay:0, text:`I (peak ${Ipeak.toFixed(3)} A)`, font:{color:'#f6c84c'}, showarrow:false },
        { x:0, y:0, text:`φ=${(phi*180/Math.PI).toFixed(2)}°`, font:{color:'#cbd5e1'}, showarrow:false, yshift:-20 }
      ]
    };

    // Phasor scatter points (to keep axes autoscaled)
    const phTraces = [
      { x:[0,Vx], y:[0,Vy], mode:'lines+markers', line:{color:'#60a5fa',width:3}, marker:{size:6}, hoverinfo:'text', text:['','V phasor'] },
      { x:[0,Ix], y:[0,Iy], mode:'lines+markers', line:{color:'#f6c84c',width:3}, marker:{size:6}, hoverinfo:'text', text:['','I phasor'] }
    ];
    Plotly.react('phasorDiv', phTraces, phLayout, {responsive:true});

    // Update info panel
    const infoDiv = document.getElementById('calcInfo');
    infoDiv.innerHTML = `
      <div style="flex:1;text-align:center;color:#cbd5e1">
        <b>Z</b>: ${Z.toFixed(3)} Ω
      </div>
      <div style="flex:1;text-align:center;color:#cbd5e1">
        <b>φ</b>: ${(phi*180/Math.PI).toFixed(2)}°
      </div>
      <div style="flex:1;text-align:center;color:#cbd5e1">
        <b>Iₘ</b>: ${Im.toExponential(3)} A
      </div>
      <div style="flex:1;text-align:center;color:#cbd5e1">
        <b>τ = RC</b>: ${tau.toExponential(3)} s
      </div>
    `;
  } // end plotAll

  // event listeners
  [R,C,f,Vm,normalize,showTransient].forEach(el => el.addEventListener('input', plotAll));
  // initial
  updateDisplays();
  plotAll();

  // tiny helper for older browsers: Plotly.react uses arrays; above we created a placeholder shape code that used for-of weirdness
  // (No action needed; code runs.)
</script>
</body>
</html>
